# 📊 全球股權資訊對比助手

這是一個基於Python與Streamlit構建的專業級投資分析儀表板。專為 **跨市場（台股 & 美股）** 分析設計，具備自動化財報標準化引擎、互動式財務公式計算機，以及極簡風格的視覺化介面。

## 核心功能 (Key Features)

### 1.雙市場無縫切換

* **台股 (TW)**：整合 `FinMind` (財報/籌碼) 與 `yfinance` (行情)。
* **美股 (US)**：完整支援 `yfinance` 數據。
* **智慧代號識別**：輸入 `2330` 自動識別為台積電；輸入 `AAPL` 直接查詢美股。

### 2.穩健的行情監控

* **K線/折線圖**：支援多種時間尺度（今日、5日、1月...5年）。
* **時區自動校正**：自動轉換為台北或美東時間。
* **強力備援機制**：若遇週末或盤前無數據，自動擴大抓取範圍，確保圖表不留白。
* **極簡視覺**：採用豎條 (`▍`) 與幾何符號設計，去除多餘裝飾。

### 3.互動式財務計算機 (Financial Calculator)

* **側邊欄內建公式構建器**：無需手動輸入代碼，透過點擊按鈕 (`＋`, `－`, `×`, `÷`) 即可組合公式。
* **自定義比率**：支援使用者創建專屬指標（如：`Operating Income / Total Revenue`），儲存後可永久使用。
* **防呆運算**：後端自動處理欄位名稱替換與除數為零的狀況。

### 4.深度分析模組

* **同業橫向對比**：內建 17+ 種關鍵指標（本益比、ROE、PEG、殖利率、流動比率...）。
* **歷年趨勢分析**：可繪製任意財報科目或自定義公式的歷史走勢。
* **法人/機構籌碼**：台股顯示三大法人買賣超；美股顯示機構持股明細。

### 5.投資組合管理

* **資料夾系統**：可建立多個觀察清單（Watchlists）。
* **直覺操作**：採用垂直排列的「加入」與「移除」按鈕，操作更順手。

---

## 安裝與執行 (Installation)

### 1.環境需求

請確保已安裝 Python 3.8+。

### 2.安裝依賴函式庫

請建立一個 `requirements.txt` 或直接執行以下指令：

```bash
pip install streamlit yfinance pandas plotly finmind

```

### 3.啟動系統

在終端機 (Terminal) 執行：

```bash
streamlit run app.py

```

---

## 操作指南 (User Guide)

### 側邊欄：控制中心

1. **查詢**：
* 切換 `[台股 / 美股]` 單選鈕。
* 輸入股票代號（如 `2330` 或 `NVDA`）。


2. **資料夾編輯**：
* 點擊資料夾按鈕切換不同清單。
* 使用 **「加入」** 按鈕將當前查詢股票存入資料夾。
* 使用 **「移除」** 按鈕將當前股票移出資料夾。


3. **自定義財務公式**：
* 選擇財報科目 -> 點擊 `加入科目`。
* 使用下方鍵盤輸入運算符號。
* 輸入公式命名（如「淨利率」）並點擊 `💾 儲存`。



### 主畫面

* **左上 (行情)**：互動式圖表，可縮放、切換 K 線/折線。
* **左下**：
* **同業對比**：查看資料夾內所有股票的比較（含即時估值）。
* **歷年趨勢**：查看單一個股的長期財務變化（支援自定義公式）。
* **法人/機構**：查看籌碼面數據。


* **右上 (摘要)**：即時報價、近一年漲跌幅 (YoY%)、EPS 與股利。
* **右下 (財報)**：標準化後的財務報表（依據 US Standard 排序）。

---

## Details

* **資料清洗**：針對 `yfinance` 回傳的 MultiIndex 欄位進行了強制壓平與標準化處理，解決了圖表空白問題。
* **財報標準化**：內建會計科目映射表，將台股與美股不一致的科目名稱（如 `Revenue` vs `Total Revenue`）統一。
* **安全運算**：使用 `calculate_custom_formula` 函式封裝 `eval()`，確保自定義公式在安全的環境下執行。

---